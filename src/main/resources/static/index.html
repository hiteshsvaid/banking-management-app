<!DOCTYPE html>
<html lang="en">
<head>
    <title>Banking Application</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="/jquery-ui.min.js"></script>
    <link rel="stylesheet" href="/jquery-ui.min.css">
    <link rel="stylesheet" href="/jquery-ui.theme.min.css">
    <script>
        var editor;
        $(document).ready(function(){
            $.get("/customers", function(data, status){
                $.each( data, function( index, value ){
                    var markup = 
                        "<tr><td class='id' id='" 
                                    + value.id + "'>" 
                                    + value.firstName + "</td><td>" + 
                                    value.lastName + 
                        "</td></tr>";
                    $("#customers_table tbody").append(markup);
                });
            });
            function appendAccountToTable(id, type, amount, name){
                var markup = 
                            "<tr id=account_" + id+ "><td>" 
                                + id +"</td><td>" 
                                + name + "</td><td>" 
                                + type 
                                + "</td><td>" 
                                + amount 
                                + "</td><td><button type='button' class='delete-account btn btn-primary' id='" 
                                + id + 
                            "'>Delete</button></td></tr>";
                        $("#accounts_table tbody").append(markup);
            }
            var customerId = 1;
            $(document).on("click", "#customers_table tr" , function() {
                customerId = $(this).find("td.id").attr("id");
                $("#accounts_table tbody").empty();
                $.get("/customers/"+ customerId + "/accounts", function(data, status){
                    $.each( data, function( index, value ){
                        appendAccountToTable(value.id, value.type, value.amount, value.nickName);
                    });
                });
            });
            $(document).on("click", ".delete-account" , function() {
                var accountId = $(this).attr("id");
                var deleteCustomerAccountUrl = "/customers/"+ customerId + "/accounts/" + accountId;
                $.ajax({
                        url: deleteCustomerAccountUrl,
                        type: 'DELETE',
                        success: function(result) {
                            $('#account_'+accountId).remove();
                        }
                    });
            });
            
            $(document).on("click", "#account-create" , function() {
                var createCustomerAccountUrl = "/customers/"+ customerId + "/accounts";                  
                $("#modalform").dialog({                                                            //Shows dialog
                    height: 250,
                    width: 450,
                    modal: true,
                    buttons: {
                        "Cancel": function() {
                            $( this ).dialog( "close" );
                        },
                        "Save": function() {
                            var data = {};
                            $('#modalform').serializeArray().map(function(x){data[x.name] = x.value;})
                            $.ajax({
                                url: createCustomerAccountUrl,
                                type:"POST",
                                data: JSON.stringify(data),
                                contentType:"application/json; charset=utf-8",
                                dataType:"json",
                                success: function(data){
                                    appendAccountToTable(data.id, data.type, data.amount, data.nickName);
                                }
                            });
                            $( this ).dialog( "close" );     
                        }
                    }
                });   
            });
        });
    </script>
</head>
<body>
<h1>Welcome to the Banking Application.</h1>
<div class="container">
    <div class="row">
        <div id="customers" class="col-md-4">
            Customers
            <table id="customers_table"  class="table">
                <thead>
                <tr>
                    <th>First Name</th>
                    <th>Last Name</th>
                </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
        <div id="accounts" class="col-md-8">
            Accounts
            <button type='button' class='account-create btn btn-primary' id='account-create'>Create Account</button>
            <table id="accounts_table" class="table">
                <thead>
                <tr>
                    <th>Account #</th>
                    <th>Name</th>
                    <th>Type</th>
                    <th>Amount(USD)</th>
                    <th></th>
                </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
    </div>
</div>
<form id="modalform" style="display:none">
  <div class="form-group">
    <label for="account-type">Choose Account type</label>
    <select name="type" id="account-type" class="form-control">
        <option value="CHECKING">Checking</option>
        <option value="SAVINGS">Savings</option>
        <option value="MONEY_MARKET">Money Market</option>
    </select>
  </div>
  <div class="form-group">
    <label for="nick-name">Nick Name</label>
    <input type="text" class="form-control" id="nick-name" name="nickName" placeholder="Nick Name">
  </div>
</form>
</body>
</html>